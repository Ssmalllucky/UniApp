(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-order-order~pages-order-order_payment"],{"49d7":function(e,t,a){"use strict";(function(e){function o(t){var a=t;a.axios_times++;var o={access_id:a.access_id,order_id:a.orde_id,module:"app",action:"order",app:"order_details"};uni.request({data:o,url:uni.getStorageSync("url"),header:{"content-type":"application/x-www-form-urlencoded"},method:"POST",success:function(t){if(200==t.data.code){var o=t.data,r=o.data,n=o.data,i=n.password_status,s=n.logistics,u=n.z_price,d=n.user_money,c=n.enterless,l=n.payment,p=n.sNo,_=n.id,y=n.remarks;if(0==r.status&&"pt"==r.otype&&(r.product_total2=r.product_total.toFixed(2),a.is_end=r.is_end,r.product_total=r.list[0].p_price=r.z_price=(100*r.z_price/100).toFixed(2)),a.is_end=r.is_end,a.user_can_open=r.user_can_open,a.user_can_can=r.user_can_can,a.user_can_after=r.user_can_after,a.payment=l,a.order=r,a.btnText1=0==a.order.status&&a.leftText?a.leftText[0]:3==a.order.status||5==a.order.status||4==a.order.status?a.leftText[1]:7==a.order.status||6==a.order.status?a.leftText[2]:"",a.btnText2="cantuan"!=a.pttype||7!=a.order.status&&6!=a.order.status&&11!=a.order.status&&12!=a.order.status?0==a.order.status&&("cantuan"!=a.pttype||"cantuan"==a.pttype&&1==a.gstatus.ptstatus)&&a.rightText?a.rightText[0]:1==a.order.status?a.order.list.length>1?a.rightText[7]:a.rightText[1]:2==a.order.status?a.rightText[2]:3==a.order.status?a.rightText[3]:7==a.order.status||6==a.order.status||12==a.order.status?a.rightText[4]:4==a.order.status?a.rightText[5]:8==a.order.status||5==a.order.status?a.rightText[6]:a.rightText&&a.rightText[0]:a.leftText[1],1==a.axios_times&&(a.flag="cantuan"==a.pttype&&2==a.gstatus.ptstatus),a.enterless=c,a.load=!1,a.sNo=p,a.order_id=_,a.z_price_=u,a.remarks=y,a.password_status=i,a.cancelGoods=t.data.data.list[0].prompt,a.is_distribution=t.data.data.list[0].is_distribution,a.cancelGoodsReason=t.data.data.list[0].r_content||"暂无！",s.length>0?a.logistics=s:a.logistics=!1,a.price=u,a.user_money=d,a.message=a.order.sNo,a.otype=a.order.otype,a.pttype=a.order.pttype,a.gstatus=a.order.gstatus,a.ordermsg=a.order.omsg,a.p_id=a.order.pro_id,a.checkgroup(),a.message.indexOf("KJ")>-1&&(a.kanjia=!0),"pt"==a.otype?(a.endpay=a.order.z_price,a.price=a.endpay):a.endpay=a.order.z_price,2==a.order.status||3==a.order.status||5==a.order.status||8==a.order.status)a.order_wl=!0,a.showPay1=!1;else if(0==a.order.status)if("cantuan"!=a.pttype||"cantuan"==a.pttype&&1==a.gstatus.ptstatus){var m=function(e){var t=new Date;a.time_c=parseInt((e-t.getTime())/1e3),a.time_c>=0?(a.time_D=Math.floor(a.time_c/60/60/24),a.time_H=Math.floor(a.time_c/3600%24),a.time_M=Math.floor(a.time_c/60%60),a.time_S=Math.floor(a.time_c%60),a.order_zt="".concat(a.time_H,"时").concat(a.time_M,"分").concat(a.time_S,"秒后订单关闭")):clearInterval(a.setTime)};a.order_wl=!1;var g=a.order.add_time,f=g.split(" "),w=f[0].replace("-","/"),h=w.replace("-","/"),T=h+","+f[1],v=new Date(T),S=v.getTime()+60*a.order.order_failure*60*1e3;if("cantuan"==a.pttype){var x=a.gstatus.endtime;x=new Date(x.replace(/-/g,"/")).getTime(),S=S>x?x:S}a.setTime=setInterval((function(){m(S)}),1e3)}else"cantuan"==a.pttype&&2==a.gstatus.ptstatus?(a.showPay1=!1,a.order_zt="此团已成功，请重新选择参团或开团",a.can_pay=!1,setTimeout((function(){return uni.showToast({title:"此团已成功，请重新选择参团或开团",icon:"none",duration:2e3}),!1}),700)):"cantuan"==a.pttype&&3==a.gstatus.ptstatus&&(a.showPay1=!1,a.order_zt="此团已失败，请重新选择参团或开团",a.can_pay=!1,setTimeout((function(){uni.showToast({title:"此团已失败，请重新选择参团或开团",icon:"none",duration:2e3});var t={module:"app",action:"order",order_id:a.orde_id,app:"removeOrder",access_id:a.access_id};t.app="removeOrder",uni.request({data:t,url:uni.getStorageSync("url"),header:{"content-type":"application/x-www-form-urlencoded"},method:"POST",success:function(e){var t=e.data;t.code,t.message},error:function(t){e.log(t)}})}),700));else 1==a.order.status?(a.order_wl=!1,a.order_zt="等待发货",a.showPay1=!1):7==a.order.status&&(a.order_wl=!1,a.order_zt="超时关闭",a.showPay1=!1);0!=a.order.status&&(a.showPay1=!1),a.isshow()}else uni.showToast({title:t.data.message,duration:1500,icon:"none"})}})}function r(t){var a=t,o=window.location.href,r={type:"jsapi_wechat",access_id:a.access_id,app:"get_config",module:"app",action:"commcenter",url:o};uni.request({data:r,url:uni.getStorageSync("url"),header:{"content-type":"application/x-www-form-urlencoded"},method:"POST",success:function(e){if(200==e.data.code){var t=e.data.data.config.appid;a.myappid=t;var o=e.data.data.url,r="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+t+"&redirect_uri="+o+"&response_type=code&scope=snsapi_base&state=STATE#wechat_redirect";window.location.href=r}else uni.showToast({title:e.data.message,duration:1500,icon:"none"})},error:function(t){e.log(t)}})}function n(e,t){var a=t;if(a.fastTap){a.fastTap=!1;var r={module:"app",order_id:e,access_id:a.access_id,app:"delivery_delivery",action:"order"};uni.request({data:r,url:uni.getStorageSync("url"),header:{"content-type":"application/x-www-form-urlencoded"},method:"POST",success:function(e){a.fastTap=!0,200==e.data.code?(uni.showToast({title:"已提醒卖家发货！",duration:1e3,icon:"none"}),o(a)):uni.showToast({title:e.data.message,duration:1500,icon:"none"})}})}}function i(e,t){var a=t;if(a.fastTap)if(a.fastTap=!1,a.enterless)if(6==a.msg.length){var o={module:"app",action:"user",app:"payment_password",access_id:a.access_id,password:a.msg,endTime:""};uni.request({data:o,url:uni.getStorageSync("url"),header:{"content-type":"application/x-www-form-urlencoded"},method:"POST",success:function(t){a.pay_display=!1,a.fastTap=!0;var o=t.data,r=o.code,n=(o.message,o.enterless);200==r?a._payAxios(e):n?(uni.showToast({title:"您输入密码错误，请重试",duration:1e3,icon:"none"}),a.pay_display=!1,a.msg=""):n||(a.pay_display=!1,a.enterless=!1,uni.showToast({title:"您输入密码错误，请明天再使用钱包支付",duration:1e3,icon:"none"}))},error:function(e){a.fastTap=!0}})}else a.fastTap=!0,uni.showToast({title:"请输入完整密码！",duration:1e3,icon:"none"});else a.fastTap=!0,uni.showToast({title:"你输入的错误次数已达当日上限，请使用其它支付方式进行付款",duration:1e3,icon:"none"}),a.pay_display=!1}function s(t,a){var o=a,r={module:"app",action:"pay",app:"wallet_pay",m:"wallet_pay",type:"wallet_pay",access_id:o.access_id,payment_money:o.value,orde_id:o.orde_id,sNo:o.sNo,parameter:"order"};"pt"==o.otype&&(r.grade_rate=o.order.comm_discount,r.ptcode=o.ordermsg.ptcode,r.pro_id=o.p_id,r.man_num=o.ordermsg.groupman,r.page=o.pttype),uni.request({data:r,url:uni.getStorageSync("url"),header:{"content-type":"application/x-www-form-urlencoded"},method:"POST",success:function(e){o.fastTap=!0;var t=e.data,a=t.code;t.message;if(200==a)if(Number(o.price1)>0)o.wxPayStatue?o.pay_wx("wx"):o.aliPayStatue?o.pay_wx("ali"):o.baidupayStatue&&o.pay_wx("baidu_pay");else{uni.showToast({title:"支付成功！",duration:1e3,icon:"none"});var r="";r=o.order_id?o.order_id:o.or_id,o.pay_display=!1;var n="",i=Number(o.order.z_price)+Number(o.order.offset_balance);n="pt"==o.otype&&parseFloat(o.price1)<=0?"../../pagesA/group/group_end?sNo="+o.sNo+"&ptcode1="+o.ptcode:"../../pages/pay/payResult?payment_money="+i+"&sNo="+o.sNo+"&order_id="+r,uni.redirectTo({url:n})}else o.pay_display=!1,o.msg="",uni.showToast({title:e.data.message,duration:1500,icon:"none"})},error:function(t){e.log(t)},fail:function(e){}})}function u(e){var t=e;t.useWallte?t.wxPayStatue?t.pay_wx():(uni.showToast({title:"请选择支付方式！",duration:1e3,icon:"none"}),t.firstFlag=!0):t.wxPayStatue||t.aliPayStatue||t.baidupayStatue?t.wxPayStatue?t.pay_wx("wx"):t.aliPayStatue?t.pay_wx("ali"):t.baidupayStatue&&t.pay_wx("baidu_pay"):(uni.showToast({title:"请选择支付方式！",duration:1e3,icon:"none"}),t.firstFlag=!0)}function d(t){var a=t;if(a.value||(a.value=0),a.price1=a.price-Number(a.value),a.price1=a.price1.toFixed(2),"cantuan"!=a.pttype||a.iscan)if(a._gotPayType(),a.useWallte)0==a.password_status?uni.showModal({title:"提示",content:"请先设置支付密码",showCancel:!0,success:function(e){a.firstFlag=!0,e.confirm&&uni.navigateTo({url:"../../pagesB/setUp/payment"})}}):a.price1>0&&0!=Number(a.needpay)?a.wxPayStatue||a.aliPayStatue||a.baidupayStatue?0==Number(a.value)?(a.useWallte=!1,a.payThree()):a.pay_display=!0:(a.firstFlag=!0,uni.showToast({title:"余额不足，请选择其它支付方式",icon:"none",duration:1500})):a.pay_display=!0;else{if(!a.wxPayStatue&&!a.baidupayStatue&&!a.aliPayStatue)return uni.showToast({title:"请选择支付方式！",duration:1e3,icon:"none"}),void(a.firstFlag=!0);a.payThree()}else uni.showModal({title:"提示",content:"无法继续参团,需要参加其它团吗?",success:function(t){t.confirm?uni.navigateTo({url:"../../pagesA/group/group"}):t.cancel&&e.log("用户点击取消")}})}function c(e){var t=e,a={module:"app",action:"groupbuy",m:"checkgroup",access_id:t.access_id,sNo:t.message};return new Promise((function(e){uni.request({url:uni.getStorageSync("url"),data:a,success:function(e){200==e.data.code&&(t.iscan=!0)},fail:function(t){e(t)}})}))}function l(e,t){var a=t;"wxPay"==e?a.wxPayStatue?a.wxPayStatue=!1:(a.wxPayStatue=!0,a.aliPayStatue=!1,a.baidupayStatue=!1):"aliPay"==e?a.aliPayStatue?a.aliPayStatue=!1:(a.wxPayStatue=!1,a.baidupayStatue=!1,a.aliPayStatue=!0):"baidu"==e&&(a.baidupayStatue?a.baidupayStatue=!1:(a.wxPayStatue=!1,a.aliPayStatue=!1,a.baidupayStatue=!0))}function p(e){var t=e;t.loading=!0,uni.hideLoading(),uni.login({provider:"weixin",success:function(e){var a={code:e.code,sNo:t.sNo,title:t.order.list[0].p_name,type:"mini_wechat",access_id:t.access_id,total:t.price1,module:"app",action:"pay"};uni.request({url:uni.getStorageSync("url"),data:a,success:function(e){if(200===e.statusCode)if(200==e.statusCode){var a=e.data;uni.requestPayment({provider:"wxpay",timeStamp:a.timeStamp,nonceStr:a.nonceStr,package:a.package,signType:"MD5",paySign:a.paySign,success:function(e){var a="";a=t.orde_id?t.orde_id:t.or_id,setTimeout((function(){uni.showToast({title:"支付成功1！",duration:1e3,icon:"none"});var e="";e="pt"==t.otype?"../../pagesA/group/group_end?sNo="+t.sNo+"&ptcode="+t.ptcode:"../../pages/pay/payResult?payment_money="+t.order.z_price+"&sNo="+t.sNo+"&order_id="+a,uni.redirectTo({url:e})}),1e3)},fail:function(e){uni.showModal({title:"提示",content:"支付失败，请重试",success:function(e){t.$store.state.payRes=t.order_list,e.confirm?uni.redirectTo({url:"../order/myOrder"}):e.cancel&&uni.switchTab({url:"../tabBar/home"})}})},complete:function(){t.loading=!1,uni.hideLoading()}})}else uni.showModal({title:"提示",content:"支付失败，请重试",success:function(e){t.$store.state.payRes=t.order_list,e.confirm?uni.redirectTo({url:"../order/myOrder"}):e.cancel&&uni.switchTab({url:"../tabBar/home"})}});else uni.showModal({title:"提示",content:"支付失败，请重试",success:function(e){t.$store.state.payRes=t.order_list,e.confirm?uni.redirectTo({url:"../order/myOrder"}):e.cancel&&uni.switchTab({url:"../tabBar/home"})}})},fail:function(e){t.loading=!1,uni.hideLoading(),uni.showModal({title:"提示",content:"支付失败，请重试",success:function(e){t.$store.state.payRes=t.order_list,e.confirm?uni.redirectTo({url:"../order/myOrder"}):e.cancel&&uni.switchTab({url:"../tabBar/home"})}})}})},fail:function(e){t.loading=!1,uni.hideLoading(),uni.showModal({title:"提示",content:"支付失败，请重试",success:function(e){t.$store.state.payRes=t.order_list,e.confirm?uni.redirectTo({url:"../order/myOrder"}):e.cancel&&uni.switchTab({url:"../tabBar/home"})}})}})}function _(e,t){var a=t;a.frist_show=!1,a.useWallte=e.detail.value,a.useWallte?"pt"!=a.otype?Number(a.order.z_price)>Number(a.user_money)?(a.value=a.user_money,a.needpay=parseFloat(a.order.z_price-a.user_money).toFixed(2)):(a.value=a.order.z_price,a.needpay=0):Number(a.endpay)>Number(a.user_money)?(a.value=a.user_money,a.needpay=parseFloat(a.endpay-a.user_money).toFixed(2)):(a.value=a.endpay,a.needpay=0):(a.value="",a.needpay="")}function y(e,t,a,o,r){var n=r,i=[];i.push(t),1==o||0==o||2==o||3==o?n.order.list.length>1?1==o?uni.navigateTo({url:"../../pagesA/returnGoods/returnGoods?rType=true&order_details_id="+i+"&order_anking=1&r_status="+o}):uni.navigateTo({url:"../../pagesA/returnGoods/returnGoods?order_details_id="+i+"&order_anking=1&r_status="+o}):1==o?uni.navigateTo({url:"../../pagesA/returnGoods/returnGoods?rType=true&order_details_id="+i+"&order_anking=1&r_status="+o}):2==o?uni.navigateTo({url:"../../pagesA/returnGoods/returnGoods?order_details_id="+i+"&order_anking=1&r_status="+o}):uni.navigateTo({url:"../../pagesA/returnGoods/refund?refund_type=3&order_details_id="+i+"&order_anking=1&r_status=3&rType=3"}):4==o||3==o&&uni.navigateTo({url:"../evaluate/evaluating?order_id="+t+"&num=one"})}function m(e){var t={module:"app",order_id:e.orde_id,access_id:e.access_id,app:"see_extraction_code",action:"order"};uni.request({data:t,url:uni.getStorageSync("url"),header:{"content-type":"application/x-www-form-urlencoded"},method:"POST",success:function(t){e.receiving_shop.flag=!0,e.fastTap=!0,200==t.data.code?e.receiving_check=t.data.list:uni.showToast({title:t.data.message,duration:1500,icon:"none"})}})}function g(t,a,r,n,i){var s=i,u={module:"app",action:"order",order_id:r,access_id:s.access_id};0==n?(u.app="removeOrder",uni.request({data:u,url:uni.getStorageSync("url"),header:{"content-type":"application/x-www-form-urlencoded"},method:"POST",success:function(e){var t=e.data,a=t.code;t.message;200==a?(s.is_remove_order=!0,uni.showToast({title:"取消成功！",duration:1e3,icon:"none"}),setTimeout((function(){uni.navigateBack({delta:1})}),1e3)):202==a?(uni.showToast({title:"卖家已发货！",duration:1e3,icon:"none"}),o(s)):uni.showToast({title:e.data.message,duration:1e3,icon:"none"})},error:function(t){e.log(t)}})):7==n||6==n?uni.navigateTo({url:"../expressage/expressage?sNo="+a}):2!=n&&3!=n&&5!=n&&4!=n||(u.app="del_order",uni.request({data:u,url:uni.getStorageSync("url"),header:{"content-type":"application/x-www-form-urlencoded"},method:"POST",success:function(e){var t=e.data,a=t.code,o=t.message;200==a?(uni.showToast({title:"删除成功！",duration:1e3,icon:"none"}),uni.navigateBack({delta:1})):uni.showToast({title:o,duration:1e3,icon:"none"})},error:function(t){e.log(t)}}))}function f(t,a,r,n){var i=n;if(1==r)uni.navigateTo({url:"../returnGoods/returnGoods?order_details_id="+a+"&order_anking=1"});else if(0==r){if(i.is_end)return uni.showToast({title:"拼团活动已经结束！！",duration:1500,icon:"none"}),!1;if(!i.order.user_can_ms)return uni.showToast({title:"此商品秒杀数已达上限！",duration:1500,icon:"none"}),!1;if(!i.order.user_can_buy_ms)return uni.showToast({title:"此秒杀商品已经超过秒杀时间！",duration:1500,icon:"none"}),!1;if(!i.order.user_can_can)return uni.showToast({title:"参团数已达上限！",duration:1500,icon:"none"}),!1;if(!i.order.user_can_open)return uni.showToast({title:"开团数已达上限",duration:1500,icon:"none"}),!1;if(i.order.isagain_can&&"cantuan"==i.pttype)return uni.showToast({title:"不可重复参加此商品的团！",duration:1500,icon:"none"}),!1;if(i.order.isagain_open&&"kaituan"==i.pttype)return uni.showToast({title:"不可重复开此商品的团！",duration:1500,icon:"none"}),!1;if(i.order.isinpt)return uni.showToast({title:"你已经参加过该团！",duration:1500,icon:"none"}),!1;n._pay_style()}else if(2==r){var s={module:"app",action:"order",app:"ok_Order",order_id:a,access_id:n.access_id};uni.request({data:s,url:uni.getStorageSync("url"),header:{"content-type":"application/x-www-form-urlencoded"},method:"POST",success:function(e){var t=e.data,a=t.code;t.message;200==a?(uni.showToast({title:"收货成功",duration:1500,icon:"none"}),setTimeout((function(){o(i)}),1500)):uni.showToast({title:e.data.message,duration:1500,icon:"none"})},error:function(t){e.log(t)}})}else if(3==r)uni.navigateTo({url:"../evaluate/evaluating?order_id="+n.orde_id+"&num=all"});else if(7==r||6==r||12==r){if(i.is_end)return uni.showToast({title:"拼团活动已经结束！",duration:1500,icon:"none"}),!1;s={module:"app",action:"order ",app:"buy_again",id:a,access_id:n.access_id};uni.request({data:s,url:uni.getStorageSync("url"),header:{"content-type":"application/x-www-form-urlencoded"},method:"POST",success:function(e){var t=e.data,a=t.cart_id,o=t.code;t.message;200==o?(i.cart_id(a),i.address_id(""),uni.navigateTo({url:"../pay/orderDetailsr?returnR=2&&buy_again=true"})):uni.showToast({title:e.data.message,duration:1500,icon:"none"})},error:function(t){e.log(t)}})}else if(4==r){var u=uni.getStorageSync("url")+"&module=app&action=kefu";setTimeout((function(){window.location.href=u}),500)}else 5!=r&&8!=r||uni.navigateTo({url:"../evaluate/evaluating?order_id="+a+"&add=true"})}function w(e,t){var a=t;if(1==e)uni.showToast({title:"请不要频繁点击提醒！",duration:1e3,icon:"none"});else if(0==e){a.stau_num=1;var o=86400;a.timer||(a.count=o,a.timer=setInterval((function(){a.count>0&&a.count<=o?a.count--:(a.stau_num=0,clearInterval(a.timer),a.timer=null)}),1e3)),uni.showToast({title:"已提醒卖家发货！",duration:1e3,icon:"none"})}}function h(e,t,a){var o=a;o.needpay=parseFloat(o.endpay-e).toFixed(2),o.$nextTick((function(){if(o.price1=o.price-o.value,o.price1=Number(o.price1).toFixed(2),Number(o.value)>o.price?(Number(o.price)<=Number(o.user_money)?o.value=o.price:o.value=o.user_money,uni.showToast({title:"已超过最大金额",icon:"none",duration:1500})):Number(o.value)<Number(o.price)&&Number(o.value)>Number(o.user_money)&&(o.value=o.user_money,uni.showToast({title:"已超过最大金额",icon:"none",duration:1500})),o.price,Number(o.value),0==Math.abs(e-t)){var a=String(e).indexOf(".")+1,r=String(e).length-a;r>2&&0!=a&&(o.value=Number(e).toFixed(2))}else Math.abs(e-t)<.009999999999&&(o.value=Number(o.value).toFixed(2))}))}function T(e,t){var a=t,o={access_id:a.access_id,sNo:a.sNo,title:a.order.list[0].p_name,module:"app",action:"pay",type:"app_wechat",total:a.price1};a.wxPayStatue?(o.type="jsapi_wechat",o.code=a.code):a.aliPayStatue?o.type="alipay_mobile":a.baidupayStatue;var r=a.LaiKeTuiCommon.getMPAliAuthCode();return r.then((function(e){return new Promise((function(e){uni.request({url:uni.getStorageSync("url"),data:o,success:function(t){200==t.statusCode?e(t):uni.showToast({title:t.data.message,duration:1500,icon:"none"})},fail:function(t){e(t)}})}))}))}function v(e){var t=e;uni.showModal({title:"提示",content:"支付失败,查看订单详情",success:function(e){t.firstFlag=!0,e.confirm?window.location.href=uni.getStorageSync("h5_url")+"pages/order/myOrder?status=1":e.cancel&&(window.location.href=uni.getStorageSync("h5_url")+"pages/tabBar/home")}})}function S(e,t){var a=t("#order_no input");a.select(),document.execCommand("Copy"),uni.showToast({title:"复制成功",duration:1500,icon:"none"})}a("99af"),a("c975"),a("a9e3"),a("b6802"),a("d3b7"),a("acd8"),a("e25e"),a("ac1f"),a("5319"),a("1276"),Object.defineProperty(t,"__esModule",{value:!0}),t._axios=o,t.toUrl=r,t.txfh=n,t._confirm=i,t._payAxios=s,t.payThree=u,t._pay_style=d,t.checkgroup=c,t.chooseWay=l,t.weixinPay=p,t.switchChange=_,t._after=y,t._receiving=m,t._submitOne=g,t._submitTwo=f,t.back_click=w,t.changeValue=h,t.getOrderInfo=T,t._payFail=v,t.onCopy=S}).call(this,a("5a52")["default"])}}]);